<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Survey Page!</title>

	<!-- linking bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- linking to jQuery CDN and Bootstrap's js -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<style type="text/css">
		body {
			background-color: lightgreen;
		}

		#formDiv {
			background-color: lightblue;
		}
	</style>

</head>
<body>
	
	<!-- header content -->
	<div class="jumbotron text-center">
		<h1>Time for surveying!</h1>
		<h3>When ready please select your responses on a scale of 1 (strongly disagree) to 5 (strongly agree). <br><br>Once completed, please submit your responses to view your friend match!</h3>
	</div>

	<!-- main content -->
	<div class="container text-center">
		
		<div class="row">
			<div class="column col-xs-12 well">
				
				<div class="form-group text-left">
					<label for="userName"><h3>Name:</h3></label>
					<input type="text" class="form-control" id="userName">
				</div>

				<div class="form-group text-left">
					<label for="userPhoto"><h3>URL Link to Your Picture:</h3></label>
					<input type="text" class="form-control" id="userPhoto">
				</div><hr><br>

				<button class="btn btn-lg btn-primary" id="beginSurvey">Begin Survey!</button>
			</div>
		</div>

		<div class="row" id="questions">
			<div class="column col-xs-12 hidden" id="formDiv">
				<form>

					<div class="form-group"><hr><br>
						<label for="q0">I like to be a leader.</label>
						<div class="radio" id="q0">
							<label>
								<input type="radio" value="1" id="q0v1" name="optradio0">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q0v2" name="optradio0">2
							</label>
							<label>
								<input type="radio" value="3" id="q0v3" name="optradio0">3
							</label>
							<label>
								<input type="radio" value="4" id="q0v4" name="optradio0">4
							</label>
							<label>
								<input type="radio" value="5" id="q0v5" name="optradio0">5 (Strongly Agree)
							</label>
						</div><hr><br>
					</div>

					<div class="form-group">
						<label for="q1">I like being outdoors.</label>
						<div class="radio" id="q1">
							<label>
								<input type="radio" value="1" id="q1v1" name="optradio1">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q1v2" name="optradio1">2
							</label>
							<label>
								<input type="radio" value="3" id="q1v3" name="optradio1">3
							</label>
							<label>
								<input type="radio" value="4" id="q1v4" name="optradio1">4
							</label>
							<label>
								<input type="radio" value="5" id="q1v5" name="optradio1">5 (Strongly Agree)
							</label>
						</div><hr><br>
					</div>

						<label for="q2">I like to be alone or in small groups.</label>
						<div class="radio" id="q2">
							<label>
								<input type="radio" value="1" id="q2v1" name="optradio2">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q2v2" name="optradio2">2
							</label>
							<label>
								<input type="radio" value="3" id="q2v3" name="optradio2">3
							</label>
							<label>
								<input type="radio" value="4" id="q2v4" name="optradio2">4
							</label>
							<label>
								<input type="radio" value="5" id="q2v5" name="optradio2">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q3">I like to read in quiet.</label>
						<div class="radio" id="q3">
							<label>
								<input type="radio" value="1" id="q3v1" name="optradio3">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q3v2" name="optradio3">2
							</label>
							<label>
								<input type="radio" value="3" id="q3v3" name="optradio3">3
							</label>
							<label>
								<input type="radio" value="4" id="q3v4" name="optradio3">4
							</label>
							<label>
								<input type="radio" value="5" id="q3v5" name="optradio3">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q4">I like consuming digital entertainment.</label>
						<div class="radio" id="q4">
							<label>
								<input type="radio" value="1" id="q4v1" name="optradio4">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q4v2" name="optradio4">2
							</label>
							<label>
								<input type="radio" value="3" id="q4v3" name="optradio4">3
							</label>
							<label>
								<input type="radio" value="4" id="q4v4" name="optradio4">4
							</label>
							<label>
								<input type="radio" value="5" id="q4v5" name="optradio4">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q5">I like it when the future is unknown.</label>
						<div class="radio" id="q5">
							<label>
								<input type="radio" value="1" id="q5v1" name="optradio5">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q5v2" name="optradio5">2
							</label>
							<label>
								<input type="radio" value="3" id="q5v3" name="optradio5">3
							</label>
							<label>
								<input type="radio" value="4" id="q5v4" name="optradio5">4
							</label>
							<label>
								<input type="radio" value="5" id="q5v5" name="optradio5">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q6">I like adventureous activities.</label>
						<div class="radio" id="q6">
							<label>
								<input type="radio" value="1" id="q6v1" name="optradio6">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q6v2" name="optradio6">2
							</label>
							<label>
								<input type="radio" value="3" id="q6v3" name="optradio6">3
							</label>
							<label>
								<input type="radio" value="4" id="q6v4" name="optradio6">4
							</label>
							<label>
								<input type="radio" value="5" id="q6v5" name="optradio6">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q7">I like to try new foods.</label>
						<div class="radio" id="q7">
							<label>
								<input type="radio" value="1" id="q7v1" name="optradio7">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q7v2" name="optradio7">2
							</label>
							<label>
								<input type="radio" value="3" id="q7v3" name="optradio7">3
							</label>
							<label>
								<input type="radio" value="4" id="q7v4" name="optradio7">4
							</label>
							<label>
								<input type="radio" value="5" id="q7v5" name="optradio7">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q8">I like having a routine.</label>
						<div class="radio" id="q8">
							<label>
								<input type="radio" value="1" id="q8v1" name="optradio8">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q8v2" name="optradio8">2
							</label>
							<label>
								<input type="radio" value="3" id="q8v3" name="optradio8">3
							</label>
							<label>
								<input type="radio" value="4" id="q8v4" name="optradio8">4
							</label>
							<label>
								<input type="radio" value="5" id="q8v5" name="optradio8">5 (Strongly Agree)
							</label>
						</div><hr><br>

						<label for="q9">I like having pets.</label>
						<div class="radio" id="q9">
							<label>
								<input type="radio" value="1" id="q9v1" name="optradio9">1 (Strongly Disagree)
							</label>
							<label>
								<input type="radio" value="2" id="q9v2" name="optradio9">2
							</label>
							<label>
								<input type="radio" value="3" id="q9v3" name="optradio9">3
							</label>
							<label>
								<input type="radio" value="4" id="q9v4" name="optradio9">4
							</label>
							<label>
								<input type="radio" value="5" id="q9v5" name="optradio9">5 (Strongly Agree)
							</label>
						</div><hr><br>

					</div>

					<div class="well hidden" id="answerSubmit">
						<button class="btn btn-block btn-primary">Submit!</button>
					</div>

				</form> <!-- close form -->
			</div> <!-- close questions column -->
		</div> <!-- close questions row -->
	</div> <!-- close content container -->
	<br><br><br><br><br><br><br>

	<!-- modal content -->
	<div class="container text-center">
		<div id="friendMatchModal" class="modal fade" data-keyboard="false" data-backdrop="static">
			<div class="modal-dialog modal-lg">

				<div class="modal-content">

					<div class="modal-header">
						<h4 class="modal-title">Please view your friend match below!</h4>
					</div>

					<div class="modal-body">

						<div class="panel panel-success">

							<div class="panel-heading">
								<h2 class="panel-title">Friend Match:</h2>
							</div> <!-- closes panel heading -->

							<div class="panel-body" id="pb1">								
								
							</div> <!-- close panel body -->

						</div> <!-- close panel -->
					
						<!-- buttons to direct the user after results -->
						<ul class="nav nav-pills nav-justified">
							<li class=""><a href="/home" id="mainPage">Return to Main Page</a></li>
							<li class=""><a href="/survey" id="surveyPage">Retake Survey</a></li>
						</ul>

					</div>

				</div> <!-- closes modal content -->
			</div> <!-- closes modal dialog -->
		</div> <!-- closes modal -->
	</div> <!-- closes container for modal -->



</body>

<script type="text/javascript">

	// variable declarations
	var friendsDataArray;

	var userAnswerArray = [];

	var allFriendsTotals = [];

	var foundFriend;

	var image;

	// getting the friends data and storing it for use later
	$.ajax({
		url: "/api/friends",
		method: "GET"
	}).done(function(friendArray) {
		console.log(friendArray);
		friendsDataArray = friendArray;
	})

	$("#beginSurvey").on("click", function() {

		event.preventDefault();

		// ensuring that the name and photo fileds are not empty
		if ($("#userName").val() == "") {
			return;
		} else if ($("#userPhoto").val() == "") {
			return;
		} else {
			$("#formDiv").removeClass("hidden");
		}
	})

	// submit button functionality
	$("#answerSubmit").on("click", function() {
		
		event.preventDefault();

		// storing the value of each radio button's for later evaluation
		$("#questions input:checked").each(function(i, answer){
			userAnswerArray.push($(answer).val())
		})

		// checking the user's responses against the friends' data
		checkFriends();

		// posting the user's responses into the friends api path
		$.post("/api/friends",
			{
				name: $("#userName").val().trim(),
				photo: $("#userPhoto").val().trim(),
				scores: userAnswerArray,
			}
		);

		// bringing up the modal and adding the matched friend's data inside the modal
		$("#friendMatchModal").modal("show");

		foundFriend = allFriendsTotals.indexOf(Math.min.apply(Math, allFriendsTotals));

		image = $("<img>").attr("src", friendsDataArray[foundFriend].photo);

		$("#pb1").append("<h1>" + friendsDataArray[foundFriend].name + "</h1><br>");

		$("#pb1").append(image);

		// removing the checks from the radio buttons
		$("input").prop("checked", false);

	})

	// shows the submit button/well styling when all questions have user input
	$("input").on("click", function() {

		var responseCheck = $("#questions input:checked");

		if (responseCheck.length > 9) {
			$("#answerSubmit").removeClass("hidden");
		}


	});

	// function that evaluates the user's answers against the stored friends' data
	checkFriends = function() {

		allFriendsTotals = [];

		// initial loop through friends
		for (var i = 0; i < friendsDataArray.length; i++) {

			var currentFriendAbs = []

			// looping the scores, once inside each friend
			for (var j = 0; j < friendsDataArray[i].scores.length; j++) {
		    	currentFriendAbs.push(Math.abs(friendsDataArray[i].scores[j] - userAnswerArray[j]));
			}

			// adding up the absolute value differences
			var currentFriendTotal = currentFriendAbs.reduce(add, 0);

			function add(a, b) {
		    	return a + b;
			}

			// pushing normalized data into the total's array
			allFriendsTotals.push(currentFriendTotal);

			currentFriendAbs = [];
		}
	}

	

</script>

</html>